<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Budget Meals - Smart Meal Planning</title>
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <header class="header">
            <div class="container">
                <h1><i class="fas fa-utensils"></i> Family Budget Meals</h1>
                <p class="tagline">Smart meal planning within your budget</p>
            </div>
        </header>

        <main class="main">
            <div class="container">
                <!-- Setup Form -->
                <section id="setup-section" class="section">
                    <div class="card">
                        <h2><i class="fas fa-cog"></i> AI-Powered Meal Planning</h2>
                        <form id="meal-planner-form" class="form">
                                                        <div class="form-group">
                                <label for="weekly-budget">Weekly Budget ($)</label>
                                <input type="number" id="weekly-budget" name="weeklyBudget" min="20" step="5" required>
                                <small class="form-help">How much do you want to spend on groceries this week?</small>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="adults">Adults</label>
                                    <input type="number" id="adults" name="adults" min="1" max="10" value="2" required>
                                </div>
                                <div class="form-group">
                                    <label for="kids">Kids</label>
                                    <input type="number" id="kids" name="kids" min="0" max="10" value="0">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="kid-ages">Kids Ages (comma separated, if any)</label>
                                <input type="text" id="kid-ages" name="kidAges" placeholder="e.g., 5, 8, 12">
                            </div>

                            <div class="form-group">
                                <label for="zipcode">Zip Code (for local Walmart pricing)</label>
                                <input type="text" id="zipcode" name="zipcode" placeholder="12345" pattern="[0-9]{5}" maxlength="5" required>
                                <small>We'll find pricing from your nearest Walmart store</small>
                            </div>

                            <div class="form-group">
                                <label for="meals-count">Number of Meals to Plan</label>
                                <select id="meals-count" name="mealsCount" required>
                                    <option value="7">7 meals (1 week)</option>
                                    <option value="14">14 meals (2 weeks)</option>
                                    <option value="21">21 meals (3 weeks)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="allergies">Allergies & Dislikes</label>
                                <textarea id="allergies" name="allergies" rows="3" placeholder="List any food allergies, dietary restrictions, or strong dislikes..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-magic"></i> Generate Meal Plan
                            </button>
                        </form>
                    </div>
                </section>

                <!-- Loading -->
                <section id="loading-section" class="section hidden">
                    <div class="card text-center">
                        <i class="fas fa-spinner fa-spin fa-3x"></i>
                        <h3>Creating Your Budget-Friendly Meal Plan...</h3>
                        <p>Finding the best recipes and calculating costs</p>
                    </div>
                </section>

                <!-- Results -->
                <section id="results-section" class="section hidden">
                    <div class="results-header">
                        <h2><i class="fas fa-calendar-alt"></i> Your Meal Plan</h2>
                        <div class="budget-summary">
                            <div class="budget-item">
                                <span class="label">Budget:</span>
                                <span class="value" id="total-budget">$0</span>
                            </div>
                            <div class="budget-item">
                                <span class="label">Estimated Cost:</span>
                                <span class="value" id="estimated-cost">$0</span>
                            </div>
                            <div class="budget-item">
                                <span class="label">Per Meal:</span>
                                <span class="value" id="per-meal-cost">$0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Meal Plan Grid -->
                    <div id="meal-plan-grid" class="meal-grid">
                        <!-- Meals will be inserted here -->
                    </div>

                    <!-- Shopping List -->
                    <div class="card">
                        <div class="shopping-list-header">
                            <h3><i class="fas fa-shopping-cart"></i> Shopping List</h3>
                            <button id="save-shopping-list-btn" class="btn btn-sm btn-secondary">
                                <i class="fas fa-bookmark"></i> Save List
                            </button>
                        </div>
                        <div id="shopping-list" class="shopping-list-checklist">
                            <!-- Shopping list will be inserted here -->
                        </div>
                        <div class="shopping-total">
                            <strong>Total Cost: <span id="shopping-total">$0.00</span></strong>
                            <p class="price-source">Prices from Walmart Store #<span id="store-number">----</span></p>
                        </div>
                    </div>

                    <!-- Website Integration Notice -->
                    <div class="card" style="background: linear-gradient(135deg, #e3f2fd, #f8f9fa); border-left: 4px solid #2196f3;">
                        <h3><i class="fas fa-globe"></i> familybudgetmeals.com</h3>
                        <p><i class="fas fa-info-circle" style="color: #2196f3; margin-right: 8px;"></i>All recipes from your meal plans will be automatically added to <strong>familybudgetmeals.com</strong> to help other families find budget-friendly meal ideas!</p>
                        <p style="font-size: 0.9em; color: #666; margin-top: 10px;"><em>Coming Soon: Visit the website to browse all community recipes and meal planning tips.</em></p>
                    </div>

                    <div class="plan-actions">
                        <button id="start-over-btn" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Start Over
                        </button>
                        <button id="save-all-recipes-btn" class="btn btn-secondary">
                            <i class="fas fa-file-pdf"></i> Save All Recipes to PDF
                        </button>
                        <button id="save-meal-plan-btn" class="btn btn-secondary">
                            <i class="fas fa-save"></i> Save This Meal Plan
                        </button>
                        <button id="view-saved-btn" class="btn btn-secondary">
                            <i class="fas fa-folder-open"></i> View Saved Recipes
                        </button>
                        <button id="new-plan-btn" class="btn btn-outline">
                            <i class="fas fa-refresh"></i> Create New Plan
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Secure API and Services -->
    <script src="js/services/secureAPIClient.js"></script>
    
    <!-- Data and Utilities -->
    <script src="js/data/recipes.js"></script>
    <script src="js/data/prices.js"></script>
    <script src="js/utils/pricing.js"></script>
    <script src="js/utils/walmartAPI.js"></script>
    <script src="js/utils/mealSelector.js"></script>
    <script src="js/utils/simpleShoppingList.js"></script>
    <script src="js/utils/recipeSaver.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Initialize App -->
    <script>
        // Initialize the app when all scripts are loaded
        document.addEventListener('DOMContentLoaded', function() {
            try {
                window.app = new FamilyBudgetMealsApp();
                console.log('Family Budget Meals App initialized successfully');
            } catch (error) {
                console.error('Failed to initialize app:', error);
                document.body.innerHTML += `
                    <div style="position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 15px; border-radius: 5px; z-index: 9999;">
                        ⚠️ App initialization failed. Check console for details.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>